
PATH=\s60v1\epoc32\tools\;\s60v1\epoc32\gcc\bin\;C:\winnt\system32;C:\winnt;C:\winnt\System32\Wbem;C:\Program Files\ATI Technologies\ATI Control Panel;C:\Program Files\Common Files\Adaptec Shared\System;C:\Perl\bin;\s60v1\epoc32\tools;c:\MSVC6\VC98\Bin;C:\s60v1\epoc32\tools\nokia_compiler\Symbian_Tools\Command_Line_Tools;C:\Program Files\CSL Arm Toolchain\arm-none-symbianelf\bin;C:\Program Files\CSL Arm Toolchain\bin

# EPOC DEFINITIONS

EPOCBLD = \s60v1\EPOC32\BUILD\PICODRIVE\S60\PICODRIVES60\WINS\ #
EPOCTRG = \s60v1\EPOC32\RELEASE\WINS\ #
EPOCLIB = \s60v1\EPOC32\RELEASE\WINS\ #
EPOCLINK = \s60v1\EPOC32\RELEASE\WINS\ #
EPOCSTATLINK = \s60v1\EPOC32\RELEASE\WINS\ #

EPOCBLDUDEB = $(EPOCBLD)UDEB
EPOCTRGUDEB = $(EPOCTRG)UDEB
EPOCLIBUDEB = $(EPOCLIB)UDEB
EPOCLINKUDEB = $(EPOCLINK)UDEB
EPOCSTATLINKUDEB = $(EPOCSTATLINK)UDEB

EPOCBLDUREL = $(EPOCBLD)UREL
EPOCTRGUREL = $(EPOCTRG)UREL
EPOCLIBUREL = $(EPOCLIB)UDEB
EPOCLINKUREL = $(EPOCLINK)UDEB
EPOCSTATLINKUREL = $(EPOCSTATLINK)UREL


TRGDIR = Z\SYSTEM\APPS\PICODRIVES60

DATADIR = Z\SYSTEM\DATA

LIBRARY :
	@echo WARNING: Not attempting to create "$(EPOCLIB)UDEB\PICODRIVE.LIB".
	@echo When exports are frozen in "\PICODRIVE\BWINS\PICODRIVEU.DEF", regenerate Makefile.


# REAL TARGET - IMPORT LIBRARY

"$(EPOCLIB)UDEB\PICODRIVE.LIB" : "\PICODRIVE\BWINS\PICODRIVEU.DEF" MAKEWORKLIBRARY
	lib.exe /nologo /machine:i386 /nodefaultlib /name:"PICODRIVE.DLL" /def:"\PICODRIVE\BWINS\PICODRIVEU.DEF" /out:"$(EPOCLIB)UDEB\PICODRIVE.LIB"
	del "$(EPOCLIB)UDEB\PICODRIVE.exp"


MAKEWORKLIBRARY : "\s60v1\EPOC32\RELEASE\WINS\UDEB"

"\s60v1\EPOC32\RELEASE\WINS\UDEB" :
	@perl -S emkdir.pl "\s60v1\EPOC32\RELEASE\WINS\UDEB"


# BUILD - UDEB

LIBS= \
	"$(EPOCSTATLINKUDEB)\PICO.LIB" \
	"$(EPOCSTATLINKUDEB)\A68K.OBJ" \
	"$(EPOCSTATLINKUDEB)\MZ80_ASM.OBJ" \
	"$(EPOCLINKUDEB)\CONE.LIB" \
	"$(EPOCLINKUDEB)\EIKCORE.LIB" \
	"$(EPOCLINKUDEB)\MEDIACLIENTAUDIOSTREAM.LIB" \
	"$(EPOCLINKUDEB)\EUSER.LIB" \
	"$(EPOCLINKUDEB)\ZLIB.LIB" \
	"$(EPOCLINKUDEB)\EFSRV.LIB" \
	"$(EPOCLINKUDEB)\ESTLIB.LIB" \
	"$(EPOCLINKUDEB)\FBSCLI.LIB" \
	"$(EPOCLINKUDEB)\ESTOR.LIB" \
	"$(EPOCLINKUDEB)\EIKCOCTL.LIB" \
	"$(EPOCLINKUDEB)\WS32.LIB" \
	"$(EPOCLINKUDEB)\AVKON.LIB" \
	"$(EPOCLINKUDEB)\BAFL.LIB" \
	"$(EPOCLINKUDEB)\BITGDI.LIB" \
	"$(EPOCLINKUDEB)\EIKDLG.LIB"

LINK_OBJS= \
	"$(EPOCBLDUDEB)\PICODRIVE.UID.obj" \
	"$(EPOCBLDUDEB)\PICODRIVEEXE.obj" \
	"$(EPOCBLDUDEB)\UNZIP.obj"

STAGE1_LINK_FLAGS="$(EPOCSTATLINKUDEB)\EDLL.LIB" \
 $(LIBS) /nologo /entry:"_E32Dll" /subsystem:windows /dll /debug \
 /incremental:no /machine:IX86 /nodefaultlib /include:"?_E32Dll@@YGHPAXI0@Z" /out:"$(EPOCBLDUDEB)\PICODRIVE.DLL" /WARN:3

PRELINKUDEB : $(LINK_OBJS) "$(EPOCSTATLINKUDEB)\EDLL.LIB" $(LIBS)
	link.exe @<<
		$(STAGE1_LINK_FLAGS) $(LINK_OBJS)
<<
	del "$(EPOCBLDUDEB)\PICODRIVE.DLL"
	del "$(EPOCBLDUDEB)\PICODRIVE.exp"
	dumpbin /exports /out:"$(EPOCBLDUDEB)\PICODRIVE.inf" "$(EPOCBLDUDEB)\PICODRIVE.lib"
	del "$(EPOCBLDUDEB)\PICODRIVE.lib"
	perl -S makedef.pl -Inffile "$(EPOCBLDUDEB)\PICODRIVE.inf" "$(EPOCBLD)PICODRIVE.def" 
	del "$(EPOCBLDUDEB)\PICODRIVE.inf"
	lib.exe  /nologo /machine:i386 /nodefaultlib /name:"PICODRIVE.DLL" /def:"$(EPOCBLD)PICODRIVE.def" /out:"$(EPOCBLDUDEB)\PICODRIVE.lib"
	del "$(EPOCBLDUDEB)\PICODRIVE.lib"
	@echo First-stage link successful


STOPLINKUDEB : DELEXPOBJUDEB
	@echo Stopped the build by removing the export object,
	@echo if present, because the pre-link stage failed


POSTBUILDUDEB : DELEXPOBJUDEB LIBRARY


DELEXPOBJUDEB :
	if exist "$(EPOCBLDUDEB)\PICODRIVE.exp" del "$(EPOCBLDUDEB)\PICODRIVE.exp"



# BUILD - UREL

LIBS= \
	"$(EPOCSTATLINKUREL)\PICO.LIB" \
	"$(EPOCSTATLINKUREL)\A68K.OBJ" \
	"$(EPOCSTATLINKUREL)\MZ80_ASM.OBJ" \
	"$(EPOCLINKUREL)\CONE.LIB" \
	"$(EPOCLINKUREL)\EIKCORE.LIB" \
	"$(EPOCLINKUREL)\MEDIACLIENTAUDIOSTREAM.LIB" \
	"$(EPOCLINKUREL)\EUSER.LIB" \
	"$(EPOCLINKUREL)\ZLIB.LIB" \
	"$(EPOCLINKUREL)\EFSRV.LIB" \
	"$(EPOCLINKUREL)\ESTLIB.LIB" \
	"$(EPOCLINKUREL)\FBSCLI.LIB" \
	"$(EPOCLINKUREL)\ESTOR.LIB" \
	"$(EPOCLINKUREL)\EIKCOCTL.LIB" \
	"$(EPOCLINKUREL)\WS32.LIB" \
	"$(EPOCLINKUREL)\AVKON.LIB" \
	"$(EPOCLINKUREL)\BAFL.LIB" \
	"$(EPOCLINKUREL)\BITGDI.LIB" \
	"$(EPOCLINKUREL)\EIKDLG.LIB"

LINK_OBJS= \
	"$(EPOCBLDUREL)\PICODRIVE.UID.obj" \
	"$(EPOCBLDUREL)\PICODRIVEEXE.obj" \
	"$(EPOCBLDUREL)\UNZIP.obj"

STAGE1_LINK_FLAGS="$(EPOCSTATLINKUREL)\EDLL.LIB" \
 $(LIBS) /nologo /entry:"_E32Dll" /subsystem:windows /dll \
 /incremental:no /machine:IX86 /nodefaultlib /include:"?_E32Dll@@YGHPAXI0@Z" /out:"$(EPOCBLDUREL)\PICODRIVE.DLL" /WARN:3

PRELINKUREL : $(LINK_OBJS) "$(EPOCSTATLINKUREL)\EDLL.LIB" $(LIBS)
	link.exe @<<
		$(STAGE1_LINK_FLAGS) $(LINK_OBJS)
<<
	del "$(EPOCBLDUREL)\PICODRIVE.DLL"
	del "$(EPOCBLDUREL)\PICODRIVE.exp"
	dumpbin /exports /out:"$(EPOCBLDUREL)\PICODRIVE.inf" "$(EPOCBLDUREL)\PICODRIVE.lib"
	del "$(EPOCBLDUREL)\PICODRIVE.lib"
	perl -S makedef.pl -Inffile "$(EPOCBLDUREL)\PICODRIVE.inf" "$(EPOCBLD)PICODRIVE.def" 
	del "$(EPOCBLDUREL)\PICODRIVE.inf"
	lib.exe  /nologo /machine:i386 /nodefaultlib /name:"PICODRIVE.DLL" /def:"$(EPOCBLD)PICODRIVE.def" /out:"$(EPOCBLDUREL)\PICODRIVE.lib"
	del "$(EPOCBLDUREL)\PICODRIVE.lib"
	@echo First-stage link successful


STOPLINKUREL : DELEXPOBJUREL
	@echo Stopped the build by removing the export object,
	@echo if present, because the pre-link stage failed


POSTBUILDUREL : DELEXPOBJUREL LIBRARY


DELEXPOBJUREL :
	if exist "$(EPOCBLDUREL)\PICODRIVE.exp" del "$(EPOCBLDUREL)\PICODRIVE.exp"




RECREATEWORKSPACE :
	cd \PICODRIVE\S60
	perl -S makmake.pl -D \PICODRIVE\S60\PICODRIVES60.MMP VC6

